<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OneTime — Talk to a Stranger</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body class="talk-page">
  <div class="bg"></div>

  <!-- Fixed Header -->
  <header class="fixed-header">
    <div class="header-inner">
      <a class="brand" href="index.html" aria-label="OneTime Home">
        <svg class="logo" width="28" height="28" viewBox="0 0 48 48" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#8bc1ff"/>
              <stop offset="1" stop-color="#6ea8ff"/>
            </linearGradient>
          </defs>
          <rect x="3" y="3" width="42" height="42" rx="10" fill="url(#g)"/>
          <path d="M13 24c0-6 5-11 11-11s11 5 11 11-5 11-11 11-11-5-11-11zm7 0a4 4 0 1 0 8 0a4 4 0 0 0-8 0z" fill="#0f1226" opacity=".9"/>
        </svg>
        <div class="titles">
          <h1>OneTime</h1>
          <div class="tagline">Anonymous • Ephemeral • P2P</div>
        </div>
      </a>

      <div class="header-actions">
        <button id="themeToggle" class="btn ghost sm" title="Toggle light/dark mode" aria-pressed="false" aria-label="Toggle theme">
          <!-- Moon (dark) -->
          <svg class="moon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"/>
          </svg>
          <!-- Sun (light) -->
          <svg class="sun" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="5" fill="currentColor"/>
            <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <line x1="12" y1="1" x2="12" y2="4"/>
              <line x1="12" y1="20" x2="12" y2="23"/>
              <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
              <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
              <line x1="1" y1="12" x2="4" y2="12"/>
              <line x1="20" y1="12" x2="23" y2="12"/>
              <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
              <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
            </g>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="shell">
    <section id="talkPanel" class="panel talk-card">
      <!-- Mode bar -->
      <div class="modebar">
        <h2 class="mode-heading"><span id="modeHeadingText">Message Chat</span></h2>

        <!-- Segmented switch -->
        <div class="segSwitch" role="tablist" aria-label="Chat mode">
          <input type="radio" name="chatmode" id="modeMsg" checked aria-controls="messages" aria-selected="true" />
          <label for="modeMsg">Message</label>

          <input type="radio" name="chatmode" id="modeVid" aria-controls="videoArea" aria-selected="false" />
          <label for="modeVid">Video</label>

          <span class="knob" aria-hidden="true"></span>
        </div>

        <!-- Hidden legacy checkbox for existing JS -->
        <input type="checkbox" id="modeSwitch" style="display:none" />
      </div>

      <!-- Status only (location removed for MVP) -->
      <div class="talk-toolbar">
        <div class="status-wrap">
          <span class="dot live off" id="connDot"></span>
          <span id="roomStatus" class="muted">Connecting…</span>
          <span id="matchStatus" class="muted tiny"></span>
        </div>
      </div>

      <!-- Video area (shown in Video mode) -->
      <div id="videoArea" class="videoArea hidden" aria-live="polite">
        <video id="remoteVideo" class="remoteVideo" autoplay playsinline></video>
        <video id="localVideo" class="localVideo" autoplay muted playsinline title="Click your video to toggle side-by-side"></video>
      </div>

      <!-- Transcript/messages -->
      <ul id="messages" class="messages transcript" role="log" aria-live="polite"></ul>

      <!-- Input bar (hidden in Video mode) -->
      <form id="composer" class="inputBar" autocomplete="off">
        <input id="msgInput" class="input msgInput" placeholder="Type a message…" />
        <button class="btn primary sendBtn" id="sendBtn" type="submit">Send</button>
      </form>

      <!-- Controls -->
      <div class="controlsRow" id="videoControlsRow">
        <div class="hint"><kbd>Space</kbd> to start a <strong>Next</strong> chat</div>
        <div class="controlsRight">
          <button id="nextBtn" class="btn nextBtn">Next</button>
          <button id="leaveBtn" class="btn danger sm">Leave</button>
        </div>
      </div>
    </section>

    <footer class="foot">
      <p class="muted tiny">
        OneTime does not store messages or identities. Sessions live only in memory and disappear when you close or reload.
      </p>
    </footer>
  </main>

  <template id="msgTemplate">
    <li class="msg">
      <div class="bubble">
        <div class="meta">
          <span class="from"></span>
          <span class="time"></span>
        </div>
        <div class="text"></div>
      </div>
    </li>
  </template>

  <!-- Compatibility shim: sync radios to hidden #modeSwitch -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modeSwitch = document.getElementById('modeSwitch');
      const modeMsg    = document.getElementById('modeMsg');
      const modeVid    = document.getElementById('modeVid');
      const heading    = document.getElementById('modeHeadingText');

      function sync(){
        const video = modeVid.checked;
        if (modeSwitch) {
          modeSwitch.checked = video;
          modeSwitch.dispatchEvent(new Event('change', { bubbles: true }));
        }
        if (heading) heading.textContent = video ? 'Video Chat' : 'Message Chat';
      }

      modeMsg?.addEventListener('change', sync);
      modeVid?.addEventListener('change', sync);
      sync();
    });
  </script>

  <script src="talk.js"></script>
  <script src="theme.js" defer></script>
</body>
</html>